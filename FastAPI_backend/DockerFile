# Use official Python base image
FROM python:3.12-slim

# Set environment variables
ENV VIRTUAL_ENV=/opt/venv
ENV PATH="$VIRTUAL_ENV/bin:$PATH"

# Install uv
RUN pip install uv

# Set workdir
WORKDIR /app

# Copy your full project into the container
COPY . .

# Use uv to install dependencies (from requirements.txt or pyproject.toml)
RUN uv add -r requirements.txt
RUN uv add "mcp[cli]"
# OR
# RUN uv pip install -e .    # If using pyproject.toml

# If using pyproject.toml and it's in a subdirectory:
# WORKDIR /app/backend
# RUN uv pip install -e /app

# Start the app with supervisord
CMD ["supervisord", "-c", "supervisord.conf"]
